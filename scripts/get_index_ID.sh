
printHelpAndExit() {
    cat <<PRINTHELPANDEXIT
Program: Get IDT® for Illumina® DNA/RNA UD Index ID from FASTQ File
Version: 1.0
Contact: Per Adastra <adastra.aspera.per@gmail.com>
Usage:  
        $0 [options]
Options:

   -d  Directory with FASTQ file(s)


PRINTHELPANDEXIT
}

while getopts "d:o" opt;
do
    case $opt in
        d) FASTQ_DIR=$OPTARG ;;
        h) printHelpAndExit ;;
    esac
done

# Array of index sequence and the index ID (Plate Alpha: Index postion in plate)
# Example: A:A12 is plate A, Index in well A12. 
declare -A dna_flex_dna_ud_dict_i7=(
  ["CGCTCCAC"]="A:A1"
  ["TATCTTGT"]="A:B1"
  ["AGCTACTA"]="A:C1"
  ["CCACCAGG"]="A:D1"
  ["AGGATAAT"]="A:E1"
  ["ACAAGTGG"]="A:F1"
  ["TACTGTTC"]="A:G1"
  ["ATTAACAA"]="A:H1"
  ["CACTATCA"]="A:A2"
  ["TGTCGCTG"]="A:B2"
  ["ACAGTGTA"]="A:C2"
  ["AGCGCCAC"]="A:D2"
  ["CCTTCGTG"]="A:E2"
  ["AGTAGAGC"]="A:F2"
  ["TCGTGCAT"]="A:G2"
  ["CTATAGTC"]="A:H2"
  ["TTGCTGCC"]="A:A3"
  ["CCATCATT"]="A:B3"
  ["AGAGGCAA"]="A:C3"
  ["GCCATGTG"]="A:D3"
  ["AGGACAGG"]="A:E3"
  ["CCTAACAC"]="A:F3"
  ["ACGTTCCT"]="A:G3"
  ["TTACAGTT"]="A:H3"
  ["CCATCTCG"]="A:A4"
  ["TTGCTCTA"]="A:B4"
  ["AATGGATT"]="A:C4"
  ["CCGCATAC"]="A:D4"
  ["CGAGGTCG"]="A:E4"
  ["ATTCCATA"]="A:F4"
  ["GTCCGTAA"]="A:G4"
  ["CCGTATGT"]="A:H4"
  ["TGTAATCG"]="A:A5"
  ["CACGGCTA"]="A:B5"
  ["TCACCAAC"]="A:C5"
  ["AATATTGC"]="A:D5"
  ["CGCGGTGA"]="A:E5"
  ["ACGGATGG"]="A:F5"
  ["TTCCTACA"]="A:G5"
  ["CATTAGTG"]="A:H5"
  ["TTCAGTTG"]="A:A6"
  ["CCTGACCA"]="A:B6"
  ["AACCATAG"]="A:C6"
  ["TGGCCGGA"]="A:D6"
  ["AACCTTAT"]="A:E6"
  ["TGGTAGAG"]="A:F6"
  ["TTCGCCAC"]="A:G6"
  ["CCTATTGT"]="A:H6"
  ["CGTGTACC"]="A:A7"
  ["TACACGTT"]="A:B7"
  ["TCACAACA"]="A:C7"
  ["AAGGACGC"]="A:D7"
  ["AGGATGTG"]="A:E7"
  ["TGCGACGG"]="A:F7"
  ["AGTGGTTA"]="A:G7"
  ["TATCCGAG"]="A:H7"
  ["CCAGTCGA"]="A:A8"
  ["TTGACTAG"]="A:B8"
  ["AACGGTCT"]="A:C8"
  ["CTGGAACT"]="A:D8"
  ["CTACATGC"]="A:E8"
  ["TGAGACTT"]="A:F8"
  ["GCGGAGCC"]="A:G8"
  ["AGTATCAG"]="A:H8"
  ["TATGCCTT"]="A:A9"
  ["CGCAGCAA"]="A:B9"
  ["GGAATTGT"]="A:C9"
  ["GTGCTAGG"]="A:D9"
  ["TCCACACA"]="A:E9"
  ["TTGGAATT"]="A:F9"
  ["AAGCGCGC"]="A:G9"
  ["ACAACGCT"]="A:H9"
  ["AGCCTATG"]="A:A10"
  ["CCTTCTAA"]="A:B10"
  ["TACATCCA"]="A:C10"
  ["TGACGGCC"]="A:D10"
  ["GTAAGCAA"]="A:E10"
  ["TATGTAGT"]="A:F10"
  ["AACGAGGC"]="A:G10"
  ["CGGATGCT"]="A:H10"
  ["AGTCAGAC"]="A:A11"
  ["TCGCTATG"]="A:B11"
  ["TAATGTGT"]="A:C11"
  ["AACATCGC"]="A:D11"
  ["AGTACTCA"]="A:E11"
  ["GTATTGAC"]="A:F11"
  ["AGGAGGTA"]="A:G11"
  ["ACTTACGG"]="A:H11"
  ["AAGATACA"]="A:A12"
  ["TTCATGGT"]="A:B12"
  ["TATGATGG"]="A:C12"
  ["GGAAGTAT"]="A:D12"
  ["ATTGCACA"]="A:E12"
  ["CACCTTAA"]="A:F12"
  ["TTGTCTAC"]="A:G12"
  ["CACCGATG"]="A:H12"
  ["TTGTATCA"]="B:A1"
  ["CACAACTT"]="B:B1"
  ["TCACTGTC"]="B:C1"
  ["GTTGTAGT"]="B:D1"
  ["CCAGGCAC"]="B:E1"
  ["AGGCCGTG"]="B:F1"
  ["TACACTAC"]="B:G1"
  ["CGTGTCGT"]="B:H1"
  ["ATACATCA"]="B:A2"
  ["TATTGCGC"]="B:B2"
  ["ACAGTAAG"]="B:C2"
  ["ACCACGAC"]="B:D2"
  ["TGATGGCT"]="B:E2"
  ["TTCTTAAC"]="B:F2"
  ["ACGAACAA"]="B:G2"
  ["ATGTTGTT"]="B:H2"
  ["CTGAGCCG"]="B:A3"
  ["TCAGATTA"]="B:B3"
  ["ACGTTAGC"]="B:C3"
  ["AATTCTTG"]="B:D3"
  ["CAACGTTC"]="B:E3"
  ["TCGGCGGT"]="B:F3"
  ["CAGCACGG"]="B:G3"
  ["AGCTGGAA"]="B:H3"
  ["TAGCATAA"]="B:A4"
  ["ACCGTGTG"]="B:B4"
  ["AGAGAACC"]="B:C4"
  ["TCGAGCCA"]="B:D4"
  ["AACGCACG"]="B:E4"
  ["TGCCAACT"]="B:F4"
  ["AATGCGAA"]="B:G4"
  ["CGATGCGG"]="B:H4"
  ["TTAACCTT"]="B:A5"
  ["CAGTGGCA"]="B:B5"
  ["ATACTTGT"]="B:C5"
  ["CAGCAATC"]="B:D5"
  ["ATCCAGGT"]="B:E5"
  ["TAGAATTG"]="B:F5"
  ["CGCTGTCT"]="B:G5"
  ["TAATTAGC"]="B:H5"
  ["CTCGAATA"]="B:A6"
  ["TATCGGAC"]="B:B6"
  ["ACTCTATT"]="B:C6"
  ["CTAATAAC"]="B:D6"
  ["ACTTGTTA"]="B:E6"
  ["TGTGATAA"]="B:F6"
  ["TTACCTGG"]="B:G6"
  ["CCTCTACA"]="B:H6"
  ["TATGACAA"]="B:A7"
  ["ATAGCGGA"]="B:B7"
  ["CACAGCGG"]="B:C7"
  ["CCGGTTCC"]="B:D7"
  ["GTCCACCG"]="B:E7"
  ["CGAATCTA"]="B:F7"
  ["TGGCCTCT"]="B:G7"
  ["CAATAGGA"]="B:H7"
  ["CTGAGGAA"]="B:A8"
  ["TCAGAAGG"]="B:B8"
  ["TACTCTGC"]="B:C8"
  ["AATTGGCG"]="B:D8"
  ["CGCCATAT"]="B:E8"
  ["ACCAAGCA"]="B:F8"
  ["ATTGTTCG"]="B:G8"
  ["TGGACCGC"]="B:H8"
  ["GTAACTGA"]="B:A9"
  ["ACGGTCAG"]="B:B9"
  ["TCTAGGCG"]="B:C9"
  ["AACTTATC"]="B:D9"
  ["TGTCTGGC"]="B:E9"
  ["CCGTTCAA"]="B:F9"
  ["GTAGGTGG"]="B:G9"
  ["ATACAAGC"]="B:H9"
  ["TCATAGAT"]="B:A10"
  ["ATCAGTAC"]="B:B10"
  ["GTTGGATG"]="B:C10"
  ["TGGTGTTA"]="B:D10"
  ["GCTAATAG"]="B:E10"
  ["AATCTAGA"]="B:F10"
  ["TAGGCTCG"]="B:G10"
  ["AGAGCTTA"]="B:H10"
  ["TCGACATC"]="B:A11"
  ["ACATATCC"]="B:B11"
  ["CTTATTGG"]="B:C11"
  ["GGTGAGTA"]="B:D11"
  ["TCCGCCAA"]="B:E11"
  ["AAGTTGAC"]="B:F11"
  ["AGAATTCG"]="B:G11"
  ["GCTGACGT"]="B:H11"
  ["TGATGTAA"]="B:A12"
  ["AGGTATGG"]="B:B12"
  ["AAGACATT"]="B:C12"
  ["CCTCCGGT"]="B:D12"
  ["TGCTACTG"]="B:E12"
  ["TCTATCCT"]="B:F12"
  ["CTAGATTG"]="B:G12"
  ["AGTACAAC"]="B:H12"
  ["TCCACGTG"]="C:A1"
  ["CCGGTAAC"]="C:B1"
  ["GTAACAAT"]="C:C1"
  ["CATTGGTC"]="C:D1"
  ["TGCCGGTC"]="C:E1"
  ["ATTGATGA"]="C:F1"
  ["CTGTTGGT"]="C:G1"
  ["GCAATACA"]="C:H1"
  ["TCCAGAGA"]="C:A2"
  ["ATGGCGCC"]="C:B2"
  ["GGTCTATT"]="C:C2"
  ["TCGCGACT"]="C:D2"
  ["CTCTGGCG"]="C:E2"
  ["GTTAATTA"]="C:F2"
  ["TCAGTCTC"]="C:G2"
  ["CGGCCGAT"]="C:H2"
  ["ATGTCGTA"]="C:A3"
  ["GCCATATA"]="C:B3"
  ["CATGGCAG"]="C:C3"
  ["ATAGGTCT"]="C:D3"
  ["CCATGGTA"]="C:E3"
  ["AACAGACG"]="C:F3"
  ["TATCACTC"]="C:G3"
  ["ATAGTTAG"]="C:H3"
  ["CATTAACT"]="C:A4"
  ["TCAAGGTC"]="C:B4"
  ["ATATGCAT"]="C:C4"
  ["TAGGTATG"]="C:D4"
  ["CTACACAT"]="C:E4"
  ["GGAGAGAC"]="C:F4"
  ["TGCGCATA"]="C:G4"
  ["CATATGCG"]="C:H4"
  ["TATAGGTA"]="C:A5"
  ["ATCTCCGG"]="C:B5"
  ["AGGCTGAA"]="C:C5"
  ["GAGGAAGT"]="C:D5"
  ["GGTGGACG"]="C:E5"
  ["AGATAGTA"]="C:F5"
  ["ATGGTTGA"]="C:G5"
  ["TACCGCCT"]="C:H5"
  ["TGAACACC"]="C:A6"
  ["CCTGTCTG"]="C:B6"
  ["AACAAGTA"]="C:C6"
  ["CTACTTAG"]="C:D6"
  ["CTGTGGTG"]="C:E6"
  ["GGTATGTA"]="C:F6"
  ["GCCTAACG"]="C:G6"
  ["AGACTCAC"]="C:H6"
  ["TCCTTCGA"]="C:A7"
  ["CTGACTCT"]="C:B7"
  ["TGACAATG"]="C:C7"
  ["GCCTTGCG"]="C:D7"
  ["ATAAGGCA"]="C:E7"
  ["TACGTGCG"]="C:F7"
  ["ACTTCAAG"]="C:G7"
  ["TGAAGTGC"]="C:H7"
  ["TTGTCCGC"]="C:A8"
  ["ATGCGGAT"]="C:B8"
  ["CAACACCG"]="C:C8"
  ["TCCGTTAT"]="C:D8"
  ["CGCGAACG"]="C:E8"
  ["TTGTTGAA"]="C:F8"
  ["ATAATCCG"]="C:G8"
  ["CCGTCCTC"]="C:H8"
  ["GTATACAG"]="C:A9"
  ["CACCTGTT"]="C:B9"
  ["CTGCGTTA"]="C:C9"
  ["ATTGCGCG"]="C:D9"
  ["TGTTCCGG"]="C:E9"
  ["CTTCCTAG"]="C:F9"
  ["TTAGGCTC"]="C:G9"
  ["ACACAGGT"]="C:H9"
  ["GGTTGCGA"]="C:A10"
  ["ACAGCTAT"]="C:B10"
  ["CTAATGTA"]="C:C10"
  ["AAGATTCG"]="C:D10"
  ["TGCGCTCC"]="C:E10"
  ["ACGCCAGT"]="C:F10"
  ["GCTCTTAA"]="C:G10"
  ["TTATACGC"]="C:H10"
  ["CGGCACAC"]="C:A11"
  ["TCCGGACT"]="C:B11"
  ["GCGTATTA"]="C:C11"
  ["ATACTCTA"]="C:D11"
  ["AGTCTTCC"]="C:E11"
  ["AAGGCCAC"]="C:F11"
  ["GGATATAT"]="C:G11"
  ["CCAAGAGG"]="C:H11"
  ["ATGTAACG"]="C:A12"
  ["GAGCTTGC"]="C:B12"
  ["ATAGCCAA"]="C:C12"
  ["CGCATTCC"]="C:D12"
  ["CCTGCGGA"]="C:E12"
  ["GTAACTTG"]="C:F12"
  ["CTGCGAGC"]="C:G12"
  ["AACGTTAG"]="C:H12"
  ["TCCAACTC"]="D:A1"
  ["CTAGTGCT"]="D:B1"
  ["CCTGTAGA"]="D:C1"
  ["GGTGTCAC"]="D:D1"
  ["ATACCAAC"]="D:E1"
  ["TGTTAGCA"]="D:F1"
  ["TTACTTCT"]="D:G1"
  ["CAGGTATA"]="D:H1"
  ["AAGTTCTA"]="D:A2"
  ["GTAAGCCT"]="D:B2"
  ["TCTCATGA"]="D:C2"
  ["CTTGTGTG"]="D:D2"
  ["CACTCAAT"]="D:E2"
  ["ATATAATC"]="D:F2"
  ["TCTGCTTC"]="D:G2"
  ["CTTCGCCG"]="D:H2"
  ["TCAATGGA"]="D:A3"
  ["CTTGGTCT"]="D:B3"
  ["ATGTCCAG"]="D:C3"
  ["CGATACCA"]="D:D3"
  ["CAATTAAG"]="D:E3"
  ["AGGAGTCG"]="D:F3"
  ["CTCTGTGT"]="D:G3"
  ["TCGTCCGA"]="D:H3"
  ["CAGACGTG"]="D:A4"
  ["TGAGTACA"]="D:B4"
  ["GTTGACCT"]="D:C4"
  ["TCCTCGGA"]="D:D4"
  ["AGATTAAG"]="D:E4"
  ["TAACAGAG"]="D:F4"
  ["ATCGAGTC"]="D:G4"
  ["CCTTGCCT"]="D:H4"
  ["TTCGAAGA"]="D:A5"
  ["AAGAGGAT"]="D:B5"
  ["TTATCTTA"]="D:C5"
  ["CTGGCTCG"]="D:D5"
  ["AGATTGTC"]="D:E5"
  ["TTCAGCAT"]="D:F5"
  ["ACACCGTG"]="D:G5"
  ["CTTGTACA"]="D:H5"
  ["CCTGCAAC"]="D:A6"
  ["CTCCGTAT"]="D:B6"
  ["TGCGTCTT"]="D:C6"
  ["ATGTGTCA"]="D:D6"
  ["CAATCGGC"]="D:E6"
  ["ACGCGTGA"]="D:F6"
  ["CACGTCAG"]="D:G6"
  ["TTCCATTC"]="D:H6"
  ["CCAAGGCC"]="D:A7"
  ["GTTGCGTT"]="D:B7"
  ["AGCTAAGC"]="D:C7"
  ["TTCCTCGG"]="D:D7"
  ["TGATTATA"]="D:E7"
  ["GTTCTGTC"]="D:F7"
  ["TGCAATGA"]="D:G7"
  ["CAGGACAT"]="D:H7"
  ["CGATCGAA"]="D:A8"
  ["AATGTCGG"]="D:B8"
  ["GGTCGTGC"]="D:C8"
  ["GTGCTGTG"]="D:D8"
  ["ACAACTAC"]="D:E8"
  ["CTTGAGAG"]="D:F8"
  ["TAATTCCA"]="D:G8"
  ["CTCCACTA"]="D:H8"
  ["ACATATAG"]="D:A9"
  ["GTTCCGAA"]="D:B9"
  ["CTAGTATC"]="D:C9"
  ["CATTGTGG"]="D:D9"
  ["TGGTATAC"]="D:E9"
  ["CAACGAGA"]="D:F9"
  ["TTCACGAG"]="D:G9"
  ["AGGTGGCC"]="D:H9"
  ["TAGCTCAC"]="D:A10"
  ["CGATCTGT"]="D:B10"
  ["ATTGGCTT"]="D:C10"
  ["CGGCTGCA"]="D:D10"
  ["ACTAGATG"]="D:E10"
  ["CATAGTAA"]="D:F10"
  ["GTCTCGCC"]="D:G10"
  ["TGGATCTG"]="D:H10"
  ["GATATTGT"]="D:A11"
  ["ATTACCTC"]="D:B11"
  ["TACGTGAA"]="D:C11"
  ["CCGCGTAT"]="D:D11"
  ["CAACTGCA"]="D:E11"
  ["AGGCGCAT"]="D:F11"
  ["TGTACTGA"]="D:G11"
  ["TCCGTATA"]="D:H11"
  ["GTCCAAGC"]="D:A12"
  ["AATCTACT"]="D:B12"
  ["GGAGCGTG"]="D:C12"
  ["CTCTATCG"]="D:D12"
  ["CGGCCTTG"]="D:E12"
  ["TATGAACT"]="D:F12"
  ["CCTAAGGA"]="D:G12"
  ["GTATTCCA"]="D:H12"
  )

# Grab a FASTQ file path
A_FILE=$(ls $FASTQ_DIR | head -1)

# Read in first 20 read index sequences string (i5-i7), and sort them and then choose the highest recuring string and assign that as "INDEX_STRING"
# This sorting step accounts for cases in which demuxing produced reads in which a postion in the index string in "N"
INDEX_STRING=$(less $FASTQ_DIR/$A_FILE | head -80| grep ^@ | awk '{print $2}' | sort | uniq -c | sort -r | awk '{print $2}')

# Get the i7 which is sufficent to ID the Index.
I7_SEQUENCE="${INDEX_STRING: -8}"

# Use array to get index ID. 
INDEX_ID="${dna_flex_dna_ud_dict_i7[$I7_SEQUENCE]}"

# Return the Index ID 
echo "Index ID: "$INDEX_ID

